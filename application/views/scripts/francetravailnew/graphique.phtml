<?= $this->message  ?>

<!-- <h2>Marché local - Métier <?= $this->escape($this->codeRome) ?> - Territoire <?= $this->escape($this->territoire) ?> -->
</h2>

<!-- Dynamique du marché (Radar) -->
<canvas id="radarIndicateurs"></canvas>

<!-- Demandeurs et embauches -->
<canvas id="barDemandeursEmbauches"></canvas>

<!-- Offres d'emploi -->
<canvas id="barOffres"></canvas>

<!-- Salaire médian -->
<canvas id="barSalaire"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Radar : Indicateurs
    const radarCtx = document.getElementById('radarIndicateurs').getContext('2d');
    new Chart(radarCtx, {
        type: 'radar',
        data: {
            labels: ['Intensité d’embauche', 'Manque de main-d’œuvre', 'Attractivité salariale',
                'Conditions de travail', 'Durabilité de l’emploi', 'Inadéquation géographique'
            ],
            datasets: [{
                label: 'Indicateurs',
                data: [
                    <?= $this->indicateurs['INT_EMB'] ?>,
                    <?= $this->indicateurs['MAIN_OEUVRE'] ?>,
                    <?= $this->indicateurs['ATTR_SALARIALE'] ?>,
                    <?= $this->indicateurs['COND_TRAVAIL'] ?>,
                    <?= $this->indicateurs['DUR_EMPL'] ?>,
                    <?= $this->indicateurs['MISMATCH_GEO'] ?>
                ],
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 2
            }]
        },
        options: {
            scales: {
                r: {
                    suggestedMin: -2,
                    suggestedMax: 2
                }
            }
        }
    });

    // Barres : Demandeurs vs Embauches
    const barCtx = document.getElementById('barDemandeursEmbauches').getContext('2d');
    new Chart(barCtx, {
        type: 'bar',
        data: {
            labels: ['Demandeurs', 'Embauches'],
            datasets: [{
                label: 'Total',
                data: [<?= $this->demandeurs['total'] ?>, <?= $this->embauches['total'] ?>],
                backgroundColor: ['rgba(255, 99, 132, 0.7)', 'rgba(75, 192, 192, 0.7)']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });

    // Pie chart : Genre des demandeurs
    const pieCtx = document.getElementById('barDemandeursEmbauches');
    new Chart(pieCtx, {
        type: 'doughnut',
        data: {
            labels: ['Hommes', 'Femmes'],
            datasets: [{
                label: 'Répartition par genre',
                data: [<?= $this->demandeurs['hommes'] ?>, <?= $this->demandeurs['femmes'] ?>],
                backgroundColor: ['rgba(54, 162, 235, 0.7)', 'rgba(255, 99, 132, 0.7)']
            }]
        }
    });

    // Offres d'emploi
    const offresCtx = document.getElementById('barOffres').getContext('2d');
    new Chart(offresCtx, {
        type: 'bar',
        data: {
            labels: ['Offres'],
            datasets: [{
                label: 'Nombre d’offres',
                data: [<?= $this->offres ?>],
                backgroundColor: 'rgba(255, 206, 86, 0.7)'
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });

    // Salaire médian
    const salaireCtx = document.getElementById('barSalaire').getContext('2d');
    new Chart(salaireCtx, {
        type: 'bar',
        data: {
            labels: ['Débutant', 'Moyen', 'Expérimenté'],
            datasets: [{
                label: 'Salaire (€)',
                data: [<?= $this->salaire['Débutant'] ?>, <?= $this->salaire['Moyen'] ?>,
                    <?= $this->salaire['Expérimenté'] ?>
                ],
                backgroundColor: ['rgba(54, 162, 235, 0.7)', 'rgba(255, 206, 86, 0.7)',
                    'rgba(75, 192, 192, 0.7)'
                ]
            }]
        },
        options: {
            responsive: true
        }
    });
</script>