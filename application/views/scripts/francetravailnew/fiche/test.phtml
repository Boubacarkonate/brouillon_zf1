<h1>Offres d'emploi France Travail Fiche test</h1>

<script>
    const offres = <?= json_encode($this->offres ?? []) ?>;
</script>

<form method="get">
    <input type="text" name="motsCles" value="<?= $this->escape($this->params['motsCles'] ?? '') ?>"
        placeholder="Mots-clés">
    <input type="text" name="departement" value="<?= $this->escape($this->params['departement'] ?? '') ?>"
        placeholder="Département">
    <button type="submit">Rechercher</button>
</form>

<?php if (!empty($this->error)): ?>
    <div class="error"><?= $this->escape($this->error) ?></div>
<?php endif; ?>

<?php if (!empty($this->offres)): ?>
    <?php $page = $this->page ?? 0; ?>
    <div class="offres-container">
        <?php foreach ($this->offres as $offre): ?>
            <div class="offre-card">
                <h2><?= $this->escape($offre['intitule'] ?? '') ?></h2>
                <p><strong>Entreprise :</strong> <?= $this->escape($offre['entreprise']['nom'] ?? 'N/A') ?></p>
                <p><strong>Lieu :</strong> <?= $this->escape($offre['lieuTravail']['libelle'] ?? 'N/A') ?></p>
                <p><strong>Contrat :</strong> <?= $this->escape($offre['typeContrat'] ?? 'N/A') ?></p>
                <p><strong>Expérience :</strong> <?= $this->escape($offre['experience'] ?? 'N/A') ?></p>
                <p><strong>Salaire :</strong>
                    <?php if (!empty($offre['salaireMin']) || !empty($offre['salaireMax'])): ?>
                        <?= $this->escape($offre['salaireMin'] ?? '') ?>
                        <?= (!empty($offre['salaireMin']) && !empty($offre['salaireMax'])) ? '-' : '' ?>
                        <?= $this->escape($offre['salaireMax'] ?? '') ?> €
                    <?php else: ?>
                        N/A
                    <?php endif; ?>
                </p>
                <p><strong>Date publication :</strong> <?= $this->escape($offre['dateCreation'] ?? '') ?></p>
                <a class="btn-postuler" href="<?= $this->escape($offre['urlPostulation'] ?? '#') ?>"
                    target="_blank">Postuler</a>
            </div>
        <?php endforeach; ?>
    </div>

    <div class="pagination">
        <?php if ($page > 0): ?>
            <a href="?<?= http_build_query(array_merge($this->params, ['page' => $page - 1])) ?>">← Précédent</a>
        <?php endif; ?>
        <a href="?<?= http_build_query(array_merge($this->params, ['page' => $page + 1])) ?>">Suivant →</a>
    </div>

<?php else: ?>
    <p>Aucune offre trouvée.</p>
<?php endif; ?>

<script>
    console.log(offres);
</script>